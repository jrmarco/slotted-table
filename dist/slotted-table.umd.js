(function(e,v){typeof exports=="object"&&typeof module<"u"?module.exports=v(require("vue")):typeof define=="function"&&define.amd?define(["vue"],v):(e=typeof globalThis<"u"?globalThis:e||self,e.SlottedTable=v(e.Vue))})(this,function(e){"use strict";var v=document.createElement("style");v.textContent=`.slottedtable{width:100%;border-collapse:collapse}.slottedtable .st-header,.slottedtable .st-body{display:table;width:100%;table-layout:fixed}.slottedtable .st-row{display:table-row;background-color:#fff;color:#000}.slottedtable .st-cell{display:table-cell;border-top:1px solid black;border-bottom:1px solid black;padding:8px;text-align:center;word-wrap:break-word}.slottedtable .st-footer{display:flex;flex-direction:row;gap:1em;justify-content:flex-end;margin-top:1em;align-items:center}.slottedtable .st-pageselector{display:flex;flex-direction:row;gap:1em;align-items:center}.slottedtable .st-pageselector .st-select{display:inline-block;background-color:#fff;color:#000;border:2px solid black;text-align:center;text-decoration:none;transition:background-color .3s ease,color .3s ease;border-radius:15px;font-size:14px}.slottedtable .st-pagebtns{display:flex;flex-direction:row}.slottedtable .st-pagebtns button{display:inline-block;padding:5px 10px;border:1px solid gray;text-align:center;text-decoration:none;transition:background-color .3s ease,color .3s ease;border-radius:5px;background-color:#fff}.slottedtable .st-pagebtns .st-active{font-weight:700;background-color:green;color:#fff}.slottedtable .st-pointer{cursor:pointer}.slottedtable .st-filtercontainer{display:flex;flex-direction:row;padding-bottom:1em;align-content:center;justify-content:space-between;align-items:center}.slottedtable .st-filteractions{display:flex;flex-direction:row;gap:1em;padding-bottom:1em}.slottedtable .st-activefilter{display:flex;flex-direction:row;gap:.5em;flex-wrap:wrap;align-items:center;margin:10px 0}.slottedtable .st-activefilter>button{padding:5px 10px;border:1px solid black;cursor:pointer}.slottedtable .st-searchbutton{margin-left:5px}.slottedtable .st-bulkactions{display:flex;flex-direction:row;align-items:center;align-content:center;flex-wrap:nowrap;gap:1em}.slottedtable .st-select-all{background-color:unset;border:unset;cursor:pointer}.slottedtable .w30{width:30px!important}
`,document.head.appendChild(v);const j={pleaseWait:"Caricamento",noResults:"Nessun risultato",rowsPerPage:"Righe per pagina:",of:"di",filter:"Filtro",search:"Cerca",activefilters:"Ricerca attiva",bulkActions:"Selezionati",selectAll:"Seleziona tutto",selectCurrentPageElement:"Seleziona tutti gli elementi in questa pagina"},V={pleaseWait:"Loading",noResults:"No results",rowsPerPage:"Rows per page:",of:"of",filter:"Filter",search:"Search",activefilters:"Active search",bulkActions:"Selected",selectAll:"Select all",selectCurrentPageElement:"Select all elements in this page",unselectAll:"Unselect all"},O={pleaseWait:"Chargement",noResults:"Aucun résultat",rowsPerPage:"Lignes par page:",of:"sur",filter:"Filtrer",search:"Rechercher",activefilters:"Recherche active",bulkActions:"Sélectionnés",selectAll:"Tout sélectionner",selectCurrentPageElement:""},M={pleaseWait:"Laden",noResults:"Keine Ergebnisse",rowsPerPage:"Zeilen pro Seite:",of:"von",filter:"Filter",search:"Suche",activefilters:"Aktive Suche",bulkActions:"Ausgewählt",selectAll:"Alle auswählen",selectCurrentPageElement:"Alle Elemente auf dieser Seite auswählen"},q=l=>{switch(l){case"it":return j;case"en":return V;case"fr":return O;case"de":return M;default:return V}},t=e.ref({language:"en",trs:{},loading:!0,columns:[],ordering:{sortBy:"",sortType:""},startIndex:1,endIndex:1,page:1,rowsPerPage:10,styles:{},filters:[],prevFilters:[],hasCheckboxSelector:!1,selectorColIdentifier:"",allSelected:!1,checkboxes:{},hasServerCallback:!1,dynamicRows:{rows:[],total:0},staticRows:{rows:[],total:0,filtered:[],filteredTotal:0}}),H=l=>{const{styles:o}=t.value;if(!Object.keys(o).length)return"";function s(r){return["container","header","body","footer","row","cell","pageselector","pagebtns","filter","filteractions","activefilter","searchbutton","filterbutton"].includes(r)}return s(l)&&o[l]||""},F=l=>{const o=new Date(l);return!isNaN(o.getTime())&&l===o.toISOString().split("T")[0]?o.getTime():!1},W=l=>isNaN(Number(l))?F(l)?F(l):l:Number(l),U=()=>{const{hasServerCallback:l,dynamicRows:o,staticRows:s}=t.value;return l?o.rows:s.filtered},K=()=>{const{hasServerCallback:l,dynamicRows:o,staticRows:s}=t.value;return l?o.total:s.filteredTotal},$=()=>{Object.keys(t.value.checkboxes).forEach(o=>{t.value.checkboxes[o]=!1}),t.value.allSelected=!1},n={getStyle:H,castToType:W,getRows:U,getTotalRows:K,resetCheckboxes:$,setDisplayRowSelected:()=>{const l=[];t.value.allSelected=!1;const o=Object.keys(t.value.checkboxes);for(let r=0;r<o.length;r+=1)t.value.checkboxes[o[r]]&&l.push(o[r]);$();const s=U().map(r=>r.ST_UID);l.forEach(r=>{s.indexOf(r)!==-1&&(t.value.checkboxes[r]=!0)})}},J=["onClick","title"],Z={key:0},G=["innerHTML"],Q=["title"],X=e.defineComponent({__name:"TableHeader",emits:["update","updateSelection"],setup(l,{emit:o}){const s=o,r=e.computed(()=>t.value.columns),i=e.computed(()=>t.value.selectorColIdentifier),d=e.computed(()=>t.value.trs),w=e.computed(()=>["st-row","st-header",n.getStyle("row"),n.getStyle("header")]),h=p=>{const f=["st-cell",p.sortable?"st-pointer":"",n.getStyle("cell")];return p.value===i.value&&f.push("w30"),f},y=p=>{if(!p||!p.value||!p.sortable)return;const{sortBy:f,sortType:m}=t.value.ordering;t.value.ordering.sortType=f===p.value&&m==="asc"?"desc":"asc",t.value.ordering.sortBy=p.value,s("update")},b=p=>({width:p.width?`${p.width}px`:"auto"}),x=p=>{const{sortBy:f,sortType:m}=t.value.ordering;return f!==p?"":!m||m==="asc"?"&uarr;":"&darr;"},B=()=>{const p=n.getRows();if(t.value.allSelected){t.value.allSelected=!1,n.resetCheckboxes();return}p.forEach(f=>{t.value.checkboxes[f.ST_UID]=!t.value.checkboxes[f.ST_UID]}),s("updateSelection")};return(p,f)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(w.value)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(m,u)=>(e.openBlock(),e.createElementBlock("div",{key:m.value||u,onClick:S=>y(m),class:e.normalizeClass(h(m)),style:e.normalizeStyle(b(m)),title:m.text},[m.value!==i.value?(e.openBlock(),e.createElementBlock("b",Z,[e.createTextVNode(e.toDisplayString(m.text)+" ",1),e.createElementVNode("span",{innerHTML:x(m.value)},null,8,G)])):(e.openBlock(),e.createElementBlock("button",{key:1,class:"st-select-all",onClick:B,title:d.value.selectCurrentPageElement}," ☑️ ",8,Q))],14,J))),128))],2))}}),Y=["value"],ee=["onClick"],te={key:1},le=e.defineComponent({__name:"TableFooter",emits:["update"],setup(l,{emit:o}){const s=o,r=e.computed(()=>[5,10,25,50]),i=e.computed(()=>{const{rowsPerPage:f,page:m}=t.value;if(!n.getTotalRows())return[];const u=Math.ceil(n.getTotalRows()/f),S=m;if(u<=4)return Array.from({length:u},(_,k)=>k+1);const T=[1];return S>3&&T.push("..."),S>2&&T.push(S-1),S!==1&&S!==u&&T.push(S),S<u-1&&T.push(S+1),S<u-2&&T.push("..."),T.push(u),T}),d=e.computed({get(){return t.value.rowsPerPage},set(f){t.value.rowsPerPage=f}}),w=e.computed(()=>t.value.startIndex),h=e.computed(()=>t.value.endIndex),y=e.computed(()=>t.value.page),b=async f=>{!Number.isInteger(f)||f<1||(t.value.page=f,s("update",{clearSelected:!0}))},x=e.computed(()=>t.value.trs),B=e.computed(()=>["st-pageselector",n.getStyle("pageselector")]),p=e.computed(()=>["st-pagebtns",n.getStyle("pagebtns")]);return(f,m)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",{class:e.normalizeClass(B.value)},[e.createTextVNode(e.toDisplayString(x.value.rowsPerPage)+" ",1),e.withDirectives(e.createElementVNode("select",{name:"st-rows-per-page-selector",class:"st-select","onUpdate:modelValue":m[0]||(m[0]=u=>d.value=u),onChange:m[1]||(m[1]=u=>b(1))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,u=>(e.openBlock(),e.createElementBlock("option",{key:u,value:u},e.toDisplayString(u),9,Y))),128))],544),[[e.vModelSelect,d.value]])],2),e.createElementVNode("div",null,e.toDisplayString(w.value)+"-"+e.toDisplayString(h.value)+" "+e.toDisplayString(x.value.of)+" "+e.toDisplayString(e.unref(n).getTotalRows()||0),1),e.unref(n).getTotalRows()>d.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(p.value)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,u=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:u},[typeof u=="number"?(e.openBlock(),e.createElementBlock("button",{key:0,class:e.normalizeClass({"st-active":Number(u)===Number(y.value)}),onClick:S=>b(u)},e.toDisplayString(u),11,ee)):(e.openBlock(),e.createElementBlock("span",te,"  "))],64))),128))],2)):e.createCommentVNode("",!0)],64))}}),oe={width:"100",height:"100",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg"},ae=e.createElementVNode("circle",{cx:"50",cy:"50",r:"40",stroke:"#007bff","stroke-width":"6",fill:"none","stroke-dasharray":"251.2","stroke-dashoffset":"251.2"},[e.createElementVNode("animate",{attributeName:"stroke-dashoffset",from:"251.2",to:"0",dur:"2s",repeatCount:"indefinite"}),e.createElementVNode("animate",{attributeName:"opacity",from:"1",to:"0",dur:"2s",repeatCount:"indefinite"})],-1),se={x:"50%",y:"60%","text-anchor":"middle","font-size":"10px",fill:"#007bff"},re=e.defineComponent({__name:"SpinnerItem",props:{text:{type:String,default:""}},setup(l){return(o,s)=>(e.openBlock(),e.createElementBlock("svg",oe,[ae,e.createElementVNode("text",se,e.toDisplayString(l.text),1)]))}}),ne=e.defineComponent({__name:"BulkSelection",emits:["updateSelection"],setup(l,{emit:o}){const s=e.computed(()=>t.value.trs),r=e.computed(()=>["st-bulkactions",n.getStyle("bulkactions")]),i=e.computed(()=>s.value.selectAll),d=e.computed(()=>{const{hasServerCallback:y,checkboxes:b,dynamicRows:x,staticRows:B}=t.value,p=Object.values(b).filter(f=>f);return t.value.allSelected?y?x.total:B.total:p.length}),w=o,h=()=>{t.value.allSelected=!0;const{hasServerCallback:y,dynamicRows:b,staticRows:x}=t.value;(y?b.rows:x.rows).forEach(p=>{t.value.checkboxes[p.ST_UID]=!0}),w("updateSelection")};return(y,b)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(r.value)},[e.createElementVNode("p",null,e.toDisplayString(s.value.bulkActions)+":",1),e.createElementVNode("p",null,e.toDisplayString(d.value),1),e.createElementVNode("button",{onClick:h},e.toDisplayString(i.value),1)],2))}}),ce=["disabled"],ie=["data-key"],de=e.defineComponent({__name:"FilterComponent",emits:["update","updateSelection"],setup(l,{emit:o}){const s=e.computed(()=>t.value.trs),r=e.ref(""),i=e.ref([]),d=o,w=e.computed(()=>["st-filtercontainer",n.getStyle("filter")]),h=e.computed(()=>["st-filteractions",n.getStyle("filteractions")]),y=e.computed(()=>["st-activefilter",n.getStyle("activefilter")]),b=e.computed(()=>["st-searchbutton",n.getStyle("searchbutton")]),x=e.computed(()=>["st-filterbutton",n.getStyle("filterbutton")]),B=e.computed(()=>t.value.filters||[]),p=e.computed(()=>t.value.hasCheckboxSelector),f=e.computed(()=>t.value.hasServerCallback?t.value.dynamicRows.total:t.value.staticRows.filteredTotal),m=_=>{if(!_||_==="")return"";let k=_.trim().toLowerCase();return k=k.normalize("NFD").replace(/[\u0300-\u036f]/g,""),k=k.replace(/[^a-z0-9]/g,"-").trim(),k},u=()=>{const _=t.value.filters||[];if(r.value===""||f.value<=0)return;const k=m(r.value);if(!_||_.length===0){_||(t.value.filters=[]),n.resetCheckboxes(),t.value.filters.push(r.value),i.value.push(k),d("update",{resetPage:!0}),r.value="";return}i.value.indexOf(k)===-1&&(n.resetCheckboxes(),t.value.filters.push(r.value),i.value.push(k),d("update",{resetPage:!0}),r.value="")},S=_=>{const k=_.target,D=k.getAttribute("data-key")||"";i.value=i.value.filter(R=>R!==D),t.value.filters=t.value.filters.filter(R=>R!==k.innerHTML),k.remove(),d("update",{resetPage:!0})},T=()=>d("updateSelection");return(_,k)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",{class:e.normalizeClass(w.value)},[e.createElementVNode("div",{class:e.normalizeClass(h.value)},[e.createTextVNode(e.toDisplayString(s.value.filter)+" ",1),e.withDirectives(e.createElementVNode("input",{id:"st-text-search",type:"text",onKeyup:e.withKeys(u,["enter"]),"onUpdate:modelValue":k[0]||(k[0]=D=>r.value=D),autocomplete:"on"},null,544),[[e.vModelText,r.value]]),e.createElementVNode("button",{class:e.normalizeClass(b.value),onClick:u,disabled:f.value<=0},e.toDisplayString(s.value.search),11,ce)],2),p.value?(e.openBlock(),e.createBlock(ne,{key:0,onUpdateSelection:T})):e.createCommentVNode("",!0)],2),B.value.length>0?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(y.value)},[e.createTextVNode(e.toDisplayString(s.value.activefilters)+" ",1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value,D=>(e.openBlock(),e.createElementBlock("button",{class:e.normalizeClass(x.value),key:m(D),"data-key":m(D),onClick:S},e.toDisplayString(D),11,ie))),128))],2)):e.createCommentVNode("",!0)],64))}}),pe=()=>{const{staticRows:l,ordering:o}=t.value,{sortBy:s,sortType:r}=o;l.rows.sort((i,d)=>{const w=n.castToType(i[s]),h=n.castToType(d[s]);return w<h?r==="asc"?-1:1:w>h?r==="asc"?1:-1:0})},ue=()=>{const{filters:l,staticRows:o}=t.value;if(l.length===0){t.value.staticRows.filtered=o.rows,t.value.staticRows.filteredTotal=o.rows.length;return}const s=o.rows.filter(r=>{const i=Object.values(r).join("|").toLowerCase();let d=0;for(const w of l){const h=i.includes(w.toLowerCase());d+=h?1:0}return d===l.length});t.value.staticRows.filtered=s,t.value.staticRows.filteredTotal=s.length},fe=()=>{const{page:l,rowsPerPage:o,staticRows:s}=t.value;t.value.staticRows.filtered=s.filtered.slice((l-1)*o,l*o)},I={loadStaticData:()=>{pe(),ue(),fe()},loadServerData:async l=>{const{page:o,rowsPerPage:s,ordering:r,filters:i,prevFilters:d}=t.value,{sortBy:w,sortType:h}=r,y={page:o,rowsPerPage:s,sortBy:w,sortType:h};i.length>0?(y.filters=i,(i.length!==d.length||i.join("|")!==d.join("|"))&&(t.value.page=1,y.page=1),t.value.prevFilters=[...i]):t.value.prevFilters=[];const b=await l(y);t.value.dynamicRows.rows=b.rows,t.value.dynamicRows.total=b.totalRows},returnSelectedDynamic:()=>{const{dynamicRows:l}=t.value;return l.rows.filter(o=>t.value.checkboxes[o.ST_UID]).map(o=>{const s={...o};return delete s.ST_UID,s})},returnSelectedStatic:()=>{const{checkboxes:l,allSelected:o,staticRows:s}=t.value;return(o?s.rows:s.filtered).filter(i=>l[i.ST_UID]).map(i=>{const d={...i};return delete d.ST_UID,d})}},me={key:1},ge=["onClick"],ke={key:0},ye=["id","onUpdate:modelValue"],z=e.defineComponent({__name:"SlottedTable",props:{headers:{type:Array,default:()=>[],required:!0},baseFilter:{type:Object,default:()=>({name:"",direction:""})},selector:{type:Boolean,default:!1},items:{type:Array,default:()=>[]},styles:{type:Object,default:()=>({})},language:{type:String,default:"en"},callBack:{type:Function,default:null}},emits:["updateSelection","rowClick"],setup(l,{expose:o,emit:s}){const r=l,{headers:i,items:d,styles:w,language:h,callBack:y,selector:b}=e.toRefs(r),x=e.ref(q(h.value)),B=s,p=async a=>{if(!y.value)throw new Error("Callback is not defined or invalid");let c={};try{c=await y.value({...a})}catch(g){throw console.log(g),new Error("Callback response is invalid or errored - ")}if(c!=null&&c.rows&&c.totalRows!==void 0)return c.rows.forEach(g=>{g.ST_UID=L(g),t.value.checkboxes[g.ST_UID]=!1}),{rows:c.rows,totalRows:c.totalRows};throw new Error("Callback response is invalid or errored")},f=()=>{const{page:a,rowsPerPage:c}=t.value;t.value.startIndex=(a-1)*c+1,t.value.endIndex=Math.min(a*c,n.getTotalRows())},m=a=>({width:a.width?`${a.width}px`:"auto"}),u=e.computed(()=>t.value.loading),S=e.computed(()=>t.value.columns),T=e.computed(()=>t.value.selectorColIdentifier),_=e.computed(()=>["slottedtable",n.getStyle("container")]),k=e.computed(()=>["st-body",n.getStyle("body")]),D=e.computed(()=>["st-row",n.getStyle("row")]),R=a=>{const c=["st-cell",n.getStyle("cell")];return a&&a.value===T.value&&c.push("w30"),c},he=e.computed(()=>["st-footer",n.getStyle("footer")]),A=async()=>{const{allSelected:a,ordering:c,rowsPerPage:g}=t.value;if(t.value.hasServerCallback){if(a){const C={sortBy:c.sortBy,sortType:c.sortType,page:1,rowsPerPage:g,all:!0};return(await p(C)).rows}return I.returnSelectedDynamic()}return I.returnSelectedStatic()},be=async()=>{n.setDisplayRowSelected(),await N()},N=async()=>{const a=await A();B("updateSelection",[...a])},we=a=>{const c={...a};delete c.ST_UID,B("rowClick",c)},L=a=>{const c=JSON.stringify(a,Object.keys(a).sort());let g=Date.now()-Math.random();for(let E=0;E<c.length;E++)g=g*33^c.charCodeAt(E);return(g>>>0).toString(16)};e.onMounted(async()=>{if(t.value.selectorColIdentifier=`${Date.now()}-${Math.random().toString(36)}`,t.value.trs=x,t.value.language=h.value,b.value&&i.value.unshift({text:"",value:t.value.selectorColIdentifier,sortable:!1}),t.value.columns=i.value,t.value.styles=w.value,t.value.hasCheckboxSelector=b.value,t.value.hasServerCallback=!!y.value,t.value.hasServerCallback||(d.value.forEach(a=>{a.ST_UID=L(a),t.value.checkboxes[a.ST_UID]=!1}),t.value.staticRows.rows=d.value,t.value.staticRows.total=d.value.length),t.value.ordering.sortBy="id",t.value.ordering.sortType="desc",r.baseFilter){const{name:a,direction:c}=r.baseFilter;a&&c&&a!==""&&(t.value.ordering.sortBy=a,t.value.ordering.sortType=c)}await P()});const P=async(a={})=>{t.value.loading=!0,t.value.hasServerCallback?await I.loadServerData(p):(a!=null&&a.resetPage&&(t.value.page=1),I.loadStaticData()),f(),a!=null&&a.clearSelected&&n.resetCheckboxes(),t.value.loading=!1};return o({reloadTable:P,getSelection:async()=>[...await A()],resetSelection:()=>{const a=Object.keys(t.value.checkboxes);for(let c=0;c<a.length;c+=1)t.value.checkboxes[a[c]]=!1}}),(a,c)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(_.value)},[e.createVNode(de,{onUpdate:P,onUpdateSelection:N}),u.value||!e.unref(n).getTotalRows()?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(k.value)},[e.createElementVNode("div",{class:e.normalizeClass(D.value)},[e.createElementVNode("div",{class:e.normalizeClass(R)},[u.value?(e.openBlock(),e.createBlock(re,{key:0,text:x.value.pleaseWait},null,8,["text"])):(e.openBlock(),e.createElementBlock("span",me,e.toDisplayString(x.value.noResults),1))])],2)],2)):(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(k.value)},[e.createVNode(X,{onUpdate:P,onUpdateSelection:N}),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n).getRows(),g=>(e.openBlock(),e.createElementBlock("div",{key:g.ST_UID,class:e.normalizeClass(D.value)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.value,C=>(e.openBlock(),e.createElementBlock("div",{key:`${g.ST_UID}-${C.value}`,class:e.normalizeClass(R(C)),style:e.normalizeStyle(m(C)),onClick:E=>we(g)},[C.value===T.value?(e.openBlock(),e.createElementBlock("div",ke,[e.withDirectives(e.createElementVNode("input",{id:g.ST_UID,class:"st-row-selector",type:"checkbox","onUpdate:modelValue":E=>e.unref(t).checkboxes[g.ST_UID]=E,onChange:be},null,40,ye),[[e.vModelCheckbox,e.unref(t).checkboxes[g.ST_UID]]])])):e.renderSlot(a.$slots,C.value,{key:1,column:C.value,cellData:g[C.value]||C.empty,data:g},()=>[e.renderSlot(a.$slots,"default",{column:C.value,cellData:g[C.value]||C.empty,data:g})])],14,ge))),128))],2))),128))],2)),e.createElementVNode("div",{class:e.normalizeClass(he.value)},[e.createVNode(le,{onUpdate:P})],2)],2))}});return typeof window<"u"&&window.Vue&&window.Vue.createApp({}).component("SlottedTable",z),z});
